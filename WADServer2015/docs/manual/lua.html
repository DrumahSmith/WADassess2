<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <title>Apache Mod Lua</title>
  <meta name="Description" content="The Uniform Server Zero." />
  <meta name="Keywords" content="The Uniform Server, MPG, Mike Gleaves, Ric, UniServer, Olajide, BobS " />
  <link href="common/css/main.css" rel="stylesheet" type="text/css">
  <link href="common/css/menu.css" rel="stylesheet" type="text/css">
</head>

<body id="p1200">
<!-- Start header -->
  <script language="javascript" src="common/header.js"></script>
<!-- End header -->

<table id="main" >
<tr valign="top">

<td id="td_menu">
  <script language="javascript" src="common/top_menu.js"></script>
  <script language="javascript" src="common/lua_sub_menu.js"></script>
</td>

<td id="td_spacer" ></td >

<td id="td_content" >
<!-- ============ Start Content ========== -->

<table >
<tr>
 <td>
  <img src="common/images/zero_logo4.png" alt="Zero logo" />
 </td>
 <td>
<h1>Mod Lua</h1>
</tr>
</table>

<p>The <b>Lua scripting language</b> has been around since 1993 and was finally integrated into Apache 2.4 primarily for server configuration. Uniform Server ZeroXI uses Apache 2.4.6 this contains the Lua 5.1.5 (core). Although mod_lua is still tagged as experimental it is stable allowing you to work with hooks for Apache configuration and for creating dynamic web applications.</b> 

<p>The Uniform Server ZeroXI plugin <b>ZeroXI_lua_1_0_0.exe</b> provides support for Lua. Please note the Lua section is split over several pages and covers this plugin and basic dynamic web-applications in detail. This page covers enabling Mod-Lua and provides detailed configuration information.
.</p>

<div id="page_links_menu_shadow" >
 <div id="page_links_menu" >
  <ul>
   <li><a href="#Apache configuration" >Apache configuration</a> - Enable mod_lua</li>
   <li><a href="#Search Paths - package.path and package.cpath" >Search Paths</a>  - package.path and package.cpath</li>

   </ul>
 </div>
</div>

<a name="Apache configuration"></a>
<h2>Apache configuration</h2>

<p>A default installation of Uniform Server ZeroXI has Lua pre-configured  in Apache’s configuration file. All that is required is to enable the Lua module from UniController as follows:</p>

<p class="access">Apache &gt; Edit Basic and Modules &gt; Edit Basic Configuration</p>
<table>
<tr >
<td>

<ul>
  <li>6) Ensure <b>Lua Module</b> is enabled (default disabled) from the drop-down menu.</li>
  <li>9) Click <b>Update Configuration</b> button, applies the changes.</li>
  <li>For the new settings to become effective you must restart the Apache server.</li>
</ul>

Apache’s configuration file UniServerZ\core\apache2\conf\<b>httpd.conf</b> is modified<br />
 (# removed) to enable the line as shown:
<pre>
LoadModule lua_module modules/mod_lua.so
</pre>

This in turn enables the following configuration block,<br />
 which loads the configuration file <b>us_lua.conf</b>:
<pre>
# Uniform Server Lua config
&lt;IfModule lua_module&gt;
   Include conf/extra/us_lua.conf
&lt;/IfModule&gt;
</pre>


</td>
<td>
   <img src="images/C11_apache_basic_config_1.gif" alt="Apache basic config">
</td>
</tr>
</table>
<p>The configuration file UniServerZ\core\apache2\conf\extra\<b>us_lua.conf</b> contains the following two lines
  <ul>
    <li> AddHandler lua-script .lua</li>
    <li> #AddHandler lua-script .htm .html</li>
  </ul>

<p>Web pages with the file extension <b>.lua</b> are passed to the Lua engine for processing. If you wish you can rename these pages with a file extension of <b>.htm</b> or <b>.html</b>.</p>

<p>For these pages to be processed by the Lua engine enable the AddHandler line (#AddHandler lua-script .htm .html) in us_lua.conf configuration file.</p>


<script language="javascript" src="common/top.js"></script>
<a name="Search Paths - package.path and package.cpath"></a>
<h2>Search Paths - package.path and package.cpath</h2>

<p>Search paths in Lua are important for example the Lua <b>require</b> directive looks in both the Lua <b>module</b> and <b>extension</b> path, which are package.path and package.cpath respectively. The default paths configured by Apache mod_lua are:

<table>
 <tr valign="top">
  <td>
 <p><b><i>package.path</i></b></p>
 <pre>
.\?.lua;
C:\UniServerZ\core\apache2\bin\lua\?.lua;
C:\UniServerZ\core\apache2\bin\lua\?\init.lua;
C:\UniServerZ\core\apache2\bin\?.lua;
C:\UniServerZ\core\apache2\bin\?\init.lua;
 </pre>
  </td>

  <td>
 <p><b><i>package.cpath</i></b></p>
 <pre>
.\?.dll;
C:\UniServerZ\core\apache2\bin\?.dll;
C:\UniServerZ\core\apache2\bin\loadall.dll;


 </pre>
  </td>
</table>

<p>These target the Apache binary folder in order to separate Apache from Uniform Server two new folders were created C:\UniServerZ\core\<b>us_lua\lua</b> and C:\UniServerZ\core\<b>us_lua\clibs</b> and added to Lua <b>module</b> and <b>extension</b> paths. The paths are defined in configuration file UniServerZ\core\apache2\conf\extra\<b>us_lua.conf</b> as shown below:</p>

<table>
 <tr valign="top">
<td>
<b><i>Config file</i>:</b>
<p>Paths are defined in config file UniServerZ\core\apache2\conf\extra\<b>us_lua.conf</b> see right:<br />
Note: For portability the environment variable $HOME is used to define the top-level folder.</p>
<p>Default Uniform Server pre-configured paths are shown below:</p>
</td>

<td>
<pre>
# LuaPackagePath /path/to/include/?.lua;
LuaPackagePath ${HOME}\core\us_lua\lua\?.lua;
 
# LuaPackageCPath /path/to/include/?.dll;
LuaPackageCPath ${HOME}\core\us_lua\clibs\?.dll;
</pre>
</td>
</tr>
</table>

<table>
 <tr valign="top">
  <td>
 <p><b><i>package.path</i></b></p>
 <pre>
.\?.lua;
C:\UniServerZ\core\apache2\bin\lua\?.lua;
C:\UniServerZ\core\apache2\bin\lua\?\init.lua;
C:\UniServerZ\core\apache2\bin\?.lua;
C:\UniServerZ\core\apache2\bin\?\init.lua;
C:/UniServerZ/core/us_lua/lua/?.lua;
 </pre>
  </td>

  <td>
 <p><b><i>package.cpath</i></b></p>
 <pre>
.\?.dll;
C:\UniServerZ\core\apache2\bin\?.dll;
C:\UniServerZ\core\apache2\bin\loadall.dll;
C:/UniServerZ/core/us_lua/clibs/?.dll;


 </pre>
  </td>
</table>

<p>Note 1: The first two characters "<b>.\</b>" mean search the <b>current</b> working directory. <b><i>Important do not assume this is the folder containing your script</i>.</b> For a default installation the current working directory is C:\UniServerZ</p>

<p>Note 2: The extension folder C:\UniServerZ\core\us_lua\<b>clibs</b> contails module <b>lfs.dll</b></p>

<script language="javascript" src="common/top.js"></script>
<!-- ============ End Content ============ -->
</td>
</tr>
</table>

<!-- Start footer -->
  <script language="javascript" src="common/footer.js"></script>
<!-- End footer -->

</body>
</html>
