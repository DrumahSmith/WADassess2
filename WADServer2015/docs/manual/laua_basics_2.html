<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <title>Apache Lua Basics 2</title>
  <meta name="Description" content="The Uniform Server Zero." />
  <meta name="Keywords" content="The Uniform Server, MPG, Mike Gleaves, Ric, UniServer, Olajide, BobS " />
  <link href="common/css/main.css" rel="stylesheet" type="text/css">
  <link href="common/css/menu.css" rel="stylesheet" type="text/css">
</head>

<body id="p1220">
<!-- Start header -->
  <script language="javascript" src="common/header.js"></script>
<!-- End header -->

<table id="main" >
<tr valign="top">

<td id="td_menu">
  <script language="javascript" src="common/top_menu.js"></script>
  <script language="javascript" src="common/lua_sub_menu.js"></script>
</td>

<td id="td_spacer" ></td >

<td id="td_content" >
<!-- ============ Start Content ========== -->

<table >
<tr>
 <td>
  <img src="common/images/zero_logo4.png" alt="Zero logo" />
 </td>
 <td>
<h1>Mod Lua - Basics 2 forms get and post</h1>
</tr>
</table>

<p>This page covers forms, get, post and files</p>

<div id="page_links_menu_shadow" >
 <div id="page_links_menu" >
  <ul>
   <li><a href="#Form data and GET" >Form data and GET</a></li>
   <li><a href="#Form data and POST" >Form data and POST</a> </li>
   <li><a href="#List all files in a folder" >List all files in a folder</a></li>


   <li><a href="#" ></a></li>
   <li><a href="#" ></a></li>
   <li><a href="#Where to next" >Where to next</a></li>

   </ul>
 </div>
</div>



<a name="Form data and GET"></a>
<h2>Form data and GET</h2>
<p>Generally scripts process data entered in a form this test uses a basic html form test6.html shown below. The processing script test6.lua is shown on the right</p>

<p>The handler() function sets the MIME type to text/html and Lua heredoc creates the start of the HTML document.</p>

<table>
 <tr valign="top">
  <td>
<p><b><i>Basic form and processing script</i></b></p>

<ul>
  <li>All parameters sent by the form are returned in the objects <b>r:parseargs()</b> table (associative array)<br /><br /></li>

  <li><b><i>Alternative 1</i>:</b> Reads the <b>r:parseargs()</b> into an array <b>allargs</b>. Individul items are selected fron this array avoiding the need for a loop.  Items are output using r:puts note the use of the double dot operator for concatenations.<br /><br /></li>


  <li><b><i>Alternative 2</i>:</b> A for loop iterates through the table. A form field name is stored in variable <b>k</b> while <b>v</b> stores its matching content.</li>
  <li>The if  checks for first name and stores it in variable firstname. Similarly, the lastname variable stores the last names. </li>
  <li>The string.format() function effectively concatenates the two strings before being output by r:puts() function. </li>
</ul>

<p><b><i>test6.html</i></b></p>
<pre>
&lt;html&gt;
&lt;head&gt;&lt;title&gt;Test 6 Form&lt;/title&gt;&lt;/head&gt;
&lt;body&gt;
 &lt;p&gt;Please enter the following information.&lt;/p&gt;
 &lt;form action="test6.lua" method="get"&gt;
   Your first name:&lt;br /&gt;
   &lt;input type="text" name="firstname"&gt; &lt;br /&gt;
   Your last name:&lt;br /&gt;
   &lt;input type="text" name="lastname"&gt;  &lt;br /&gt;
   &lt;input type="submit" value="Send!" /&gt;
 &lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;

</pre>

  </td>

<td>
<p><b><i>test6.lua</i></b></p>
<pre>
function handle(r)
   r.content_type = "text/html"

r:puts [[
  &lt;html&gt;
  &lt;head&gt;&lt;title&gt;Test 6&lt;/title&gt;&lt;/head&gt;
  &lt;body&gt;
  &lt;p&gt;Lua processed data from form&lt;/p&gt;
]]

   --Alternative 1
   allargs   = r:parseargs();
   firstname = allargs["firstname"]
   lastname  = allargs["lastname"]
   r:puts("Hi " .. firstname .. " " .. lastname .. "&lt;br /&gt;")

   --Alternative 2
   for k, v in pairs(r:parseargs()) do
      if k=='firstname' then
         firstname=v
      elseif k=='lastname' then
         lastname=v
      end
   end
   r:puts(string.format("Hi %s %s", firstname, lastname))


r:puts [[
  &lt;/body&gt;&lt;/html&gt;
]]
end





</pre>
</td>
</tr>
</table>

<p><i>Run script</i>: Type the following into browser address bar: http://localhost/lua_examples/test6.html </p>


<script language="javascript" src="common/top.js"></script>
<a name="Form data and POST"></a>
<h2>Form data and POST</h2>
<p>Processing POST data instead of GET data is just a matter of replacing GET with <b>POST</b> in the html file and replacing r:parseargs() with <b>r:parsebody()</b> see files test7.html and test7.lua respectively</p>

<p>The handler() function sets the MIME type to text/html and Lua heredoc creates the start of the HTML document.</p>

<table>
 <tr valign="top">
  <td>
<p><b><i>Basic form and processing script</i></b></p>

<ul>
  <li>All parameters sent by the form are returned in the objects <b>r:parsebody()</b> table (associative array)<br /><br /></li>

  <li><b><i>Alternative 1</i>:</b> Reads the <b>r:parsebody()</b> into an array <b>allargs</b>. Individul items are selected fron this array avoiding the need for a loop.  Items are output using r:puts note the use of the double dot operator for concatenations.<br /><br /></li>


  <li><b><i>Alternative 2</i>:</b> A for loop iterates through the table. A form field name is stored in variable <b>k</b> while <b>v</b> stores its matching content.</li>
  <li>The if  checks for first name and stores it in variable firstname. Similarly, the lastname variable stores the last names. </li>
  <li>The string.format() function effectively concatenates the two strings before being output by r:puts() function. </li>
</ul>

<p><b><i>test7.html</i></b></p>
<pre>
&lt;html&gt;
&lt;head&gt;&lt;title&gt;Test 7 Form&lt;/title&gt;&lt;/head&gt;
&lt;body&gt;
 &lt;p&gt;Please enter the following information.&lt;/p&gt;
 &lt;form action="test7.lua" method="get"&gt;
   Your first name:&lt;br /&gt;
   &lt;input type="text" name="firstname"&gt; &lt;br /&gt;
   Your last name:&lt;br /&gt;
   &lt;input type="text" name="lastname"&gt;  &lt;br /&gt;
   &lt;input type="submit" value="Send!" /&gt;
 &lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;

</pre>

  </td>

<td>
<p><b><i>test7.lua</i></b></p>
<pre>
function handle(r)
   r.content_type = "text/html"

r:puts [[
  &lt;html&gt;
  &lt;head&gt;&lt;title&gt;Test 7&lt;/title&gt;&lt;/head&gt;
  &lt;body&gt;
  &lt;p&gt;Lua processed data from form&lt;/p&gt;
]]

   --Alternative 1
   allargs   = r:parsebody();
   firstname = allargs["firstname"]
   lastname  = allargs["lastname"]
   r:puts("Hi " .. firstname .. " " .. lastname .. "&lt;br /&gt;")

   --Alternative 2
   for k, v in pairs(r:parsebody()) do
      if k=='firstname' then
         firstname=v
      elseif k=='lastname' then
         lastname=v
      end
   end
   r:puts(string.format("Hi %s %s", firstname, lastname))


r:puts [[
  &lt;/body&gt;&lt;/html&gt;
]]
end





</pre>
</td>
</tr>
</table>

<p><i>Run script</i>: Type the following into browser address bar: http://localhost/lua_examples/test7.html </p>

<script language="javascript" src="common/top.js"></script>
<!-- ============ End Content ============ -->
</td>
</tr>
</table>

<!-- Start footer -->
  <script language="javascript" src="common/footer.js"></script>
<!-- End footer -->

</body>
</html>
